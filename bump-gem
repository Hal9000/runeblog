#!/usr/bin/env ruby

system("vi lib/version.rb +3")

require 'date'

$LOAD_PATH << "./lib"

require "version"

today = Date.today.strftime("%Y-%m-%d")
version = RuneBlog::VERSION

File.write("data/VERSION", "RuneBlog v #{version}   #{today}")
  
system("git pull")
system("git add data/VERSION lib/version.rb")
gs = `git status 2>&1`

if gs =~ /not staged for commit/
  puts
  puts gs
  puts "\n\n Possible bad git status. Continue? (y/n)"
  resp = gets.chomp
  case resp 
    when "y"
      system("git add -u")
      print "Commit message = "
      msg = gets.chomp
      system("git commit -m '#{msg}' && git push")
      puts "Now continuing..."
    else         # assume "no"
      puts "Exiting.\n "
      exit
  end
else
end

update = <<-EOF
  gem build runeblog.gemspec && 
  gem push runeblog-*.gem && 
  gem uninstall -x runeblog && 
  gem install runeblog
EOF
system(update)

